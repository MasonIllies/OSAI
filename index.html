<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OSAI</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon.png" />
  <link rel="apple-touch-icon" href="/favicon.png" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <meta name="theme-color" content="#000000" />

  <!-- Fonts -->
  <link rel="preload" href="/fonts/Sansation-Regular.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="preload" href="/fonts/Sansation-Bold.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="stylesheet" href="/fonts/fonts.css" />

  <!-- Site CSS -->
  <link rel="stylesheet" href="./css/styles.css" />

  <style>
    /* Ensure 16:9 video frame even if external CSS lags */
    .video-frame{ aspect-ratio:16/9; width:100%; background:rgba(0,0,0,.40); border-radius:12px; overflow:hidden; border:1px solid rgba(255,255,255,.1); position:relative; }
    .play{ position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px; background:transparent; color:rgba(255,255,255,.90); border:0; cursor:pointer; font-weight:700; }
    .play-dot{ width:56px; height:56px; border-radius:9999px; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,.95); color:#000; font-size:20px; font-weight:800; }
    .play-label{ font-size:13px }

    /* Larger, more official pay modal */
    .sheet-card{ max-width:560px !important; padding:20px !important; }
    .sheet h3{ margin:0; font-size:22px }
    .form-row{ display:flex; flex-direction:column; gap:8px; position:relative; }
    .form-row + .form-row{ margin-top:12px }
    .label{ font-size:13px; color:rgba(255,255,255,.75) }
    .input{ border-radius:12px; padding:12px 44px 12px 14px; border:1px solid rgba(255,255,255,.22); background:#fff; color:#000; font:inherit; }
    .input:focus{ outline:none; box-shadow:0 0 0 3px rgba(255,255,255,.35) }
    .toggle-eye{
      position:absolute; right:8px; top:32px;
      border:0; background:transparent; color:#333; cursor:pointer; font-size:13px; padding:6px 8px;
    }
    .row-two{ display:flex; gap:10px; flex-wrap:wrap }
    .row-two .btn{ flex:1 }
    .error-line{ color:#ff8a8a; font-size:12px; min-height:16px }
    .info-line{ color:#8ab4ff; font-size:12px; min-height:16px }
    .btn.primary{ background:#fff; color:#000 }
    .btn.primary[disabled]{ opacity:.5; cursor:not-allowed }
    .divider{ height:1px; background:rgba(255,255,255,.14); margin:12px 0 6px }
    .subtle{ color:rgba(255,255,255,.65); font-size:12px; margin:6px 0 0 }
    .email-wrap{ position:relative; display:inline-block; width:min(420px,100%) }
    .email-dd{ position:absolute; left:0; right:0; top:calc(100% + 6px); background:#0b0d10; border:1px solid rgba(255,255,255,.18); border-radius:10px; box-shadow:0 18px 40px rgba(0,0,0,.55); padding:6px; z-index:30; display:none; }
    .email-dd.open{ display:block }
    .email-item{ padding:10px 12px; border-radius:8px; cursor:pointer; color:#eaeaea; font-size:14px; display:flex; align-items:center; justify-content:space-between; }
    .email-item:hover, .email-item.active{ background:rgba(255,255,255,.08); }
    .email-hint{ color:rgba(255,255,255,.55); font-size:12px; margin-left:10px }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="glassbar">
    <div class="container nav">
      <a class="brand" href="/"><span class="brand-text">MASIN’s OSAI</span></a>
      <a id="authLink" class="nav-link small" href="#">Login</a>
    </div>
  </header>

  <!-- Main -->
  <main>
    <section class="container hero">
      <h1 class="hero-title">
        Not just another shit app built<br />
        to farm your data and trick<br />
        you into forgetting your<br />
        subscription.
      </h1>

      <p class="lede">
        Give me $20 a month and I’ll give you <span class="u">everything</span> I can develop.<br />
        Owned–created, designed, developed, marketed, and sold by me—
      </p>

      <p class="tiny-note">Welcome to OSAI. Nice to meet you.</p>
      <p class="ps">p.s. Fuck you Google.</p>

      <!-- Video card -->
      <div class="card video">
        <span class="pill intro">INTRODUCTION VIDEO</span>

        <!-- Any YouTube URL; auto-converted to embed -->
        <div class="video-frame" id="videoFrame">
          <button id="playBtn" class="play" aria-label="Play introduction video"
            data-video="https://www.youtube.com/watch?v=dQw4w9WgXcQ">
            <div class="play-dot">▶</div>
            <span class="play-label">PLAY</span>
          </button>
        </div>
      </div>

      <!-- After video -->
      <div class="after-video">
        <!-- SIGNUP with email dropdown -->
        <div class="signup">
          <div class="row centered">
            <span class="email-wrap">
              <input id="emailInput" type="email" placeholder="you@example.com" autocomplete="email" />
              <div id="emailDropdown" class="email-dd" role="listbox" aria-label="Email suggestions"></div>
            </span>
            <button id="openSignup" class="btn ghost">Sign up</button>
          </div>
        </div>

        <div class="price">
          $20/month — <span class="strong">everything I can develop.</span>
          <span class="muted">Early access + updates.</span>
        </div>

        <div class="pills">
          <span class="pill">CONTENT CREATION</span>
          <span class="pill">FINANCIAL PLANNING</span>
          <span class="pill">DAILY SCHEDULES</span>
          <span class="pill">CREATE YOUR OWN UI</span>
        </div>
      </div>
    </section>
  </main>

  <footer class="container footer">© <span id="year"></span> OSAI</footer>

  <!-- AUTH / PAY SHEET -->
  <div id="sheet" class="sheet hidden" aria-hidden="true">
    <div class="sheet-backdrop" data-close></div>
    <div class="sheet-card card">
      <div class="sheet-head">
        <h3>Create your account</h3>
        <button class="close" data-close aria-label="Close">✕</button>
      </div>

      <div class="divider"></div>

      <form id="sheetForm" class="sheet-body" onsubmit="return false;">
        <!-- Identity -->
        <div class="form-row">
          <label class="label" for="sheetEmail">Email</label>
          <input id="sheetEmail" class="input" type="email" required placeholder="you@example.com" autocomplete="email" />
          <div id="errEmail" class="error-line"></div>
        </div>

        <div class="form-row">
          <label class="label" for="sheetPass">Password</label>
          <input id="sheetPass" class="input" type="password" required placeholder="Minimum 8 characters" autocomplete="new-password" minlength="8" />
          <button type="button" class="toggle-eye" data-toggle="sheetPass" aria-label="Show password">Show</button>
        </div>

        <div class="form-row">
          <label class="label" for="sheetPass2">Confirm password</label>
          <input id="sheetPass2" class="input" type="password" required placeholder="Re-enter password" autocomplete="new-password" minlength="8" />
          <button type="button" class="toggle-eye" data-toggle="sheetPass2" aria-label="Show password">Show</button>
          <div id="errPass" class="error-line"></div>
        </div>

        <div class="row-two">
          <button id="payBtn" class="btn primary" type="submit" disabled>PAY</button>
        </div>

        <p id="authMsg" class="info-line"></p>
        <p class="subtle">You’ll be charged $20/month. Cancel anytime.</p>
      </form>
    </div>
  </div>

  <!-- Inline JS: video + dropdown + Supabase Auth (email/pass only) -->
  <script type="module">
    // --------- YOUR SUPABASE PROJECT ----------
    const SUPABASE_URL = "https://cnsuyhvkpgtwlpqvwetn.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNuc3V5aHZrcGd0d2xwcXZ3ZXRuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NjY1NzIsImV4cCI6MjA3MjQ0MjU3Mn0.tEPXUtNhZBY8ZLR0jFZtsoWewX62FDHd4QW7C3TVDS0";
    const STRIPE_CHECKOUT_URL = "/checkout"; // TODO: replace with your real Checkout route
    // ------------------------------------------

    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Footer year
    const y = document.getElementById("year"); if (y) y.textContent = new Date().getFullYear();

    // --- Video: convert any YouTube URL to embed and inject on click ---
    function toEmbed(url){
      try{
        const u=new URL(url);
        if(u.hostname.includes("youtu.be")){
          return "https://www.youtube.com/embed/"+u.pathname.replace("/","")+"?autoplay=1&rel=0";
        }
        if(u.hostname.includes("youtube.com")){
          if(u.pathname==="/watch"){
            const id=u.searchParams.get("v")||"";
            return "https://www.youtube.com/embed/"+id+"?autoplay=1&rel=0";
          }
          if(u.pathname.startsWith("/embed/")){
            return url.includes("autoplay=1") ? url : (url+(url.includes("?")?"&":"?")+"autoplay=1&rel=0");
          }
        }
      }catch(e){}
      return url;
    }
    (function(){
      const frame=document.getElementById("videoFrame");
      const btn=document.getElementById("playBtn");
      if(!frame||!btn) return;
      function inject(){
        if(frame.dataset.played==="1") return; frame.dataset.played="1";
        const raw=btn.getAttribute("data-video")||"https://www.youtube.com/watch?v=dQw4w9WgXcQ";
        const src=toEmbed(raw);
        const iframe=document.createElement("iframe");
        iframe.width="100%"; iframe.height="100%"; iframe.src=src;
        iframe.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
        iframe.allowFullscreen=true; iframe.title="Introduction video";
        frame.innerHTML=""; frame.appendChild(iframe);
      }
      btn.addEventListener("click", inject);
      btn.addEventListener("keydown", e => { if(e.key==="Enter"||e.key===" "){ e.preventDefault(); inject(); }});
    })();

    // --- Email dropdown autocomplete ---
    (function(){
      const input = document.getElementById('emailInput');
      const dd    = document.getElementById('emailDropdown');
      if(!input || !dd) return;

      const DOMAINS = ["gmail.com","icloud.com","outlook.com","yahoo.com","proton.me","pm.me","hotmail.com","live.com","me.com","hey.com","aol.com","zoho.com","osai.llc"];
      let activeIndex = -1;

      const build = (v) => {
        v = (v||"").trim(); if(!v) return [];
        const at = v.indexOf('@');
        const local = at===-1? v : v.slice(0,at);
        const dom = at===-1? "" : v.slice(at+1).toLowerCase();
        if(!local) return [];
        return DOMAINS.filter(d => dom ? d.startsWith(dom) : true).slice(0,8).map(d => `${local}@${d}`);
      };
      const render = list => {
        dd.innerHTML=""; activeIndex=-1;
        if(!list.length){ dd.classList.remove('open'); return; }
        list.forEach(s=>{
          const el=document.createElement('div'); el.className='email-item'; el.setAttribute('role','option');
          el.textContent=s; const hint=document.createElement('span'); hint.className='email-hint'; hint.textContent='Enter';
          el.appendChild(hint); el.addEventListener('mousedown', e=>{ e.preventDefault(); commit(s); });
          dd.appendChild(el);
        });
        dd.classList.add('open');
      };
      const commit = val => { input.value=val; dd.classList.remove('open'); activeIndex=-1; };
      const highlight = i => {
        const items=dd.querySelectorAll('.email-item'); items.forEach(el=>el.classList.remove('active'));
        if(i>=0 && i<items.length) items[i].classList.add('active');
      };
      input.addEventListener('input', ()=> render(build(input.value)));
      input.addEventListener('keydown', e=>{
        const items=dd.querySelectorAll('.email-item');
        if(e.key==='ArrowDown'){ if(!dd.classList.contains('open')){ render(build(input.value)); return; } activeIndex=Math.min(activeIndex+1, items.length-1); highlight(activeIndex); e.preventDefault(); }
        else if(e.key==='ArrowUp'){ if(!dd.classList.contains('open')) return; activeIndex=Math.max(activeIndex-1,0); highlight(activeIndex); e.preventDefault(); }
        else if(e.key==='Enter'){ if(dd.classList.contains('open') && activeIndex>=0 && items[activeIndex]){ commit(items[activeIndex].childNodes[0].textContent); e.preventDefault(); } }
        else if(e.key==='Escape'){ dd.classList.remove('open'); activeIndex=-1; }
      });
      document.addEventListener('click', e=>{ if(!dd.contains(e.target) && e.target !== input){ dd.classList.remove('open'); activeIndex=-1; }});
    })();

    // --- Open modal + Supabase Auth (email/pass only) ---
    (function(){
      const openBtn    = document.getElementById('openSignup');
      const sheet      = document.getElementById('sheet');
      const emailSrc   = document.getElementById('emailInput');
      const sheetEmail = document.getElementById('sheetEmail');
      const sheetPass  = document.getElementById('sheetPass');
      const sheetPass2 = document.getElementById('sheetPass2');
      const errEmail   = document.getElementById('errEmail');
      const errPass    = document.getElementById('errPass');
      const payBtn     = document.getElementById('payBtn');
      const form       = document.getElementById('sheetForm');
      const authLink   = document.getElementById('authLink');
      const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      function setAuthUI(session){
        if(session?.user){
          authLink.textContent = "Logout";
          authLink.onclick = async (e)=>{ e.preventDefault(); await supabase.auth.signOut(); setAuthUI(null); };
        }else{
          authLink.textContent = "Login";
          authLink.onclick = (e)=>{ e.preventDefault(); openSheet(); };
        }
      }

      async function refreshSessionUI(){
        const { data: { session } } = await supabase.auth.getSession();
        setAuthUI(session);
      }

      function validate(){
        let ok = true;
        const e = (sheetEmail.value || '').trim();
        if(!emailRe.test(e)){ errEmail.textContent="Enter a valid email."; ok=false; } else { errEmail.textContent=""; }
        const p1 = sheetPass.value || '';
        const p2 = sheetPass2.value || '';
        if(p1.length < 8){ errPass.textContent="Password must be at least 8 characters."; ok=false; }
        else if(p1 !== p2){ errPass.textContent="Passwords don’t match."; ok=false; }
        else { errPass.textContent=""; }
        payBtn.disabled = !ok;
        return ok;
      }

      function openSheet(){
        sheet.classList.remove('hidden'); sheet.setAttribute('aria-hidden','false');
        if(sheetEmail && emailSrc && emailSrc.value.trim()){ sheetEmail.value = emailSrc.value.trim(); }
        setTimeout(()=> sheetEmail?.focus(), 0);
        validate();
      }
      function closeSheet(){
        sheet.classList.add('hidden'); sheet.setAttribute('aria-hidden','true');
      }

      openBtn.addEventListener('click', openSheet);
      sheet.addEventListener('click', (e)=>{ if(e.target.matches('[data-close]')) closeSheet(); });
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && !sheet.classList.contains('hidden')) closeSheet(); });

      sheetEmail.addEventListener('input', validate);
      sheetPass.addEventListener('input', validate);
      sheetPass2.addEventListener('input', validate);

      // Show/Hide password toggles
      document.querySelectorAll('.toggle-eye').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.getAttribute('data-toggle');
          const input = document.getElementById(id);
          if(!input) return;
          const showing = input.type === 'text';
          input.type = showing ? 'password' : 'text';
          btn.textContent = showing ? 'Show' : 'Hide';
          btn.setAttribute('aria-label', showing ? 'Show password' : 'Hide password');
        });
      });

      // Email+Password signup -> Supabase stores credentials
      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        if(!validate()) return;
        payBtn.disabled = true; payBtn.textContent = "Creating…";
        const email = sheetEmail.value.trim();
        const pass  = sheetPass.value;

        // Try sign up first
        const { error: signUpErr } = await supabase.auth.signUp({
          email, password: pass,
          options: { emailRedirectTo: window.location.origin }
        });

        if(signUpErr){
          // If user already exists, try sign in
          if(/already registered/i.test(signUpErr.message || "")){
            const { error: signInErr } = await supabase.auth.signInWithPassword({ email, password: pass });
            if(signInErr){
              payBtn.disabled = false; payBtn.textContent = "PAY";
              errEmail.textContent = signInErr.message || "Sign in failed.";
              return;
            }
          }else{
            payBtn.disabled = false; payBtn.textContent = "PAY";
            errEmail.textContent = signUpErr.message || "Sign up failed.";
            return;
          }
        }

        // Redirect to payment flow (replace with your real Checkout link/route)
        window.location.href = STRIPE_CHECKOUT_URL + "?email=" + encodeURIComponent(email);
      });

      // auth state changes
      supabase.auth.onAuthStateChange((_event, session)=> setAuthUI(session));
      refreshSessionUI();
    })();
  </script>
</body>
</html>
